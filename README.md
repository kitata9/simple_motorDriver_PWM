# Simple motor driver PWM
モータードライバTA7291Pを使い、ツインモーター台車を走行させるためのプログラムです。
2チャンネル(スロットルおよびステア)のPWM入力を読み取り、ツインモータの台車走行用の信号に変換します。
ラジコンプロポ受信機からのPWM信号を入力としてツインモーター台車を走行させることができます。

# Requirement
* ブラシモーター用ドライバ([TA7291P](https://toshiba.semicon-storage.com/jp/product/linear/motordriver/detail.TA7291P.html))×2
* Arduino Nano

Arduinoについては小型で扱いやすいNanoを使いましたが、UnoやLeonardでも動くと思われます。ピンアサインには注意してください。

# 配線
| Arduinoピン  | 接続先 |
|-----------|------------|
| **D2** | IN2(TA7291P左) |
| **D3** | PWM入力(CH1) |
| **D4** | IN2(TA7291P右) |
| **D5** | PWM入力(CH2) |
| **D6** | Vref(TA7291P左) |
| **D9** | IN1(TA7291P右) |
| **D10** | Vref(TA7291P右) |
| **D11** | IN1(TA7291P左) |

そのほか、TA7291PのOUT1,2にはモーターを、VsにはArduinoから独立した電源入力を、Vccには5V入力(Arduinoからの出力でも動作しました)を接続します。もちろんGNDも。

# 動作仕様
PWM入力CH1,2を受けて、直進や右左折の制御を行います。
PWM入力レンジは1520μsを中心に1120μsを-100%,1920μsを100%としていますが、CH1_PWM_NおよびCH1_PWM_RANGE定数で変更できます。CH2についても同様です。
内部的には‐100%を‐1.0、100%を1.0%として正規化して処理しています。
また、スロットルやステアニュートラル時にモーターが反応しないよう、ZERO_THRESHOULDで閾値を設けています。この閾値は正規化後の値で指定します。

# TODO
制御レスポンスを高めるためにはシリアル出力をやめるのが良いと思われます。
また、デジタル出力をPORTBやPORTDなどを使って直接行うと若干の高速化を図れるかもしれません。

左右のモーター個体差を埋めるための手段を講じることが望ましいです。

# 免責事項
本ソフトウェアを使用したことによる一切の損害について、開発者は責任を負いません。
特に、消費電力の設計には十分ご注意ください。
